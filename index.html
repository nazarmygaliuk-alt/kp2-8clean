<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matrix Chat</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="./css/index.css" />
</head>

<body class="bg-gray-100 h-screen flex" x-data="chatApp()" x-init="init()">
  <!-- ======= SIDEBAR: ROOMS ======= -->
  <aside class="w-1/4 bg-white border-r flex flex-col">
    <div class="p-4 border-b">
      <h2 class="text-xl font-semibold text-gray-700">Rooms</h2>
    </div>

    <!-- List of rooms -->
    <div class="flex-1 overflow-y-auto p-2">
      <template x-for="room in rooms" :key="room.room_id">
        <div @click="selectRoom(room)"
             :class="{'bg-blue-100 border-blue-500': currentRoom?.room_id === room.room_id}"
             class="cursor-pointer border rounded p-2 mb-1 hover:bg-blue-50">
          <span x-text="room.name || room.room_id" class="text-gray-800"></span>
        </div>
      </template>
    </div>

    <!-- Create room -->
    <div class="p-3 border-t">
      <input type="text" x-model="newRoomName" placeholder="New room name"
             class="w-full border rounded p-2 mb-2 text-sm" />
      <button @click="createRoom"
              class="bg-blue-600 text-white w-full py-2 rounded hover:bg-blue-700">
        Create Room
      </button>
    </div>
  </aside>

  <!-- ======= MAIN CHAT ======= -->
  <main class="flex-1 flex flex-col">
    <!-- Header -->
    <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
      <div>
        <p><strong>Your Matrix ID:</strong>
          <span x-text="userId" class="text-blue-700"></span>
        </p>
        <p><strong>Room ID:</strong>
          <span x-text="currentRoom?.room_id || '-'"
                class="text-gray-600 cursor-pointer"
                @click="copyRoomId()"></span>
        </p>
      </div>
      <button @click="logout"
              class="text-red-600 hover:text-red-700 text-sm font-semibold">Logout</button>
    </div>

    <!-- Chat messages -->
    <div class="flex-1 overflow-y-auto p-4 bg-white">
      <template x-for="msg in messages" :key="msg.event_id">
        <div class="mb-2">
          <strong x-text="msg.sender" class="text-blue-700"></strong>:
          <span x-text="msg.body"></span>
        </div>
      </template>
    </div>

    <!-- Message input -->
    <div class="p-4 bg-gray-50 border-t flex items-center">
      <input type="text" x-model="newMessage" placeholder="Type your message here..."
             class="flex-1 border rounded p-2 mr-3" />
      <button @click="sendMessage"
              class="bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700">Send</button>
    </div>
  </main>

  <!-- ======= RIGHT PANEL: USERS & INVITES ======= -->
  <aside class="w-1/4 bg-white border-l flex flex-col">
    <div class="p-4 border-b">
      <h2 class="text-lg font-semibold text-gray-700">Users</h2>
      <p class="text-sm text-gray-500">Учасники кімнати</p>
      <ul class="mt-2 text-sm">
        <template x-for="user in roomMembers" :key="user.user_id">
          <li x-text="user.displayname || user.user_id" class="text-gray-800"></li>
        </template>
      </ul>
    </div>

    <!-- Invite user -->
    <div class="p-4 border-t">
      <input type="text" x-model="inviteUserId" placeholder="Invite user (e.g. @user:matrix.org)"
             class="w-full border rounded p-2 mb-2 text-sm" />
      <button @click="inviteUser"
              class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700">Invite</button>
    </div>

    <!-- Join room -->
    <div class="p-4 border-t">
      <input type="text" x-model="joinRoomId" placeholder="Room ID to join"
             class="w-full border rounded p-2 mb-2 text-sm" />
      <button @click="joinRoom"
              class="w-full bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600">Join Room</button>
    </div>

    <!-- Invites -->
    <div class="p-4 border-t flex-1 overflow-y-auto">
      <h3 class="font-semibold mb-2 text-gray-700">Invites</h3>
      <template x-for="room in invitedRooms" :key="room.room_id">
        <div class="flex justify-between items-center bg-gray-100 p-2 rounded mb-1">
          <span x-text="room.name" class="truncate"></span>
          <button @click="acceptInvite(room.room_id)"
                  class="bg-green-600 text-white px-2 py-1 text-xs rounded hover:bg-green-700">
            Join
          </button>
        </div>
      </template>
    </div>
  </aside>

  <!-- Scripts -->
  <script src="./js/app.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
